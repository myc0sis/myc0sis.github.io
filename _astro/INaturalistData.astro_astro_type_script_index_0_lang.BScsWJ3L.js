document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("inaturalist-data"),s=document.getElementById("search-input"),p=document.getElementById("search-button"),a=document.getElementById("image-modal"),g=document.getElementById("modal-image"),l=document.getElementById("modal-caption"),f=document.getElementsByClassName("close")[0],h=document.querySelector(".prev"),y=document.querySelector(".next");let d=0,r=[];if(e&&s&&p&&a&&g&&l&&f&&h&&y){let L=function(t){return t.replace("square","large")},m=function(t){if(t>=0&&t<r.length){const n=r[t],b=n.photos[0]?.url||"";g.src=L(b);const c=n.species_guess||n.taxon?.preferred_common_name||n.taxon?.name||"Unknown Species";l&&(l.innerHTML=`${c}<br>Observed on: ${new Date(n.observed_on).toLocaleDateString()}`),d=t}};const _=e.dataset.perPage||"5",v=e.dataset.taxonId,k=e.dataset.searchType||"general";async function E(t){if(!t.trim()){e&&(e.innerHTML="Please enter a search term.");return}e&&(e.innerHTML="Loading...");try{let n=`https://api.inaturalist.org/v1/observations?per_page=${_}&order=desc&order_by=created_at`;v&&(n+=`&taxon_id=${v}`),k==="species"?n+=`&taxon_name=${encodeURIComponent(t)}`:n+=`&q=${encodeURIComponent(t)}`;const c=await(await fetch(n)).json();if(c.results.length===0){e&&(e.innerHTML="No results found.");return}r=c.results;const u=document.createElement("div");u.className="observation-grid",r.forEach((o,B)=>{const I=o.species_guess||o.taxon?.preferred_common_name||o.taxon?.name||"Unknown Species",i=document.createElement("div");i.className="observation-item";const N=o.photos[0]?.url||"";i.innerHTML=`
              <img src="${N}" alt="${I}" loading="lazy" class="thumbnail">
              <div class="observation-info">
                <h3>${I}</h3>
                <p>Observed on: ${new Date(o.observed_on).toLocaleDateString()}</p>
              </div>
            `,u.appendChild(i),i.querySelector(".thumbnail").addEventListener("click",()=>{a&&(a.style.display="block",m(B))})}),e&&(e.innerHTML="",e.appendChild(u))}catch(n){console.error("Error fetching iNaturalist data:",n),e&&(e.innerHTML="Error loading iNaturalist data. Please try again.")}}p.addEventListener("click",()=>{E(s.value)}),s.addEventListener("keypress",t=>{t.key==="Enter"&&E(s.value)}),f.onclick=function(){a&&(a.style.display="none")},h.onclick=function(){m(d-1)},y.onclick=function(){m(d+1)},window.onclick=function(t){t.target==a&&(a.style.display="none")}}else console.error("Could not find necessary elements for iNaturalist data")});
