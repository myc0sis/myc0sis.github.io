const e=document.getElementById("inaturalist-data"),r=document.getElementById("search-input"),p=document.getElementById("search-button"),o=document.getElementById("image-modal"),g=document.getElementById("modal-image"),h=document.getElementById("modal-caption"),y=document.getElementsByClassName("close")[0];if(e&&r&&p&&o&&g&&h&&y){let f=function(t){return t.replace("square","large")};const E=e.dataset.perPage||"5",l=e.dataset.taxonId,v=e.dataset.searchType||"general";async function d(t){if(!t.trim()){e.innerHTML="Please enter a search term.";return}e.innerHTML="Loading...";try{let n=`https://api.inaturalist.org/v1/observations?per_page=${E}&order=desc&order_by=created_at`;l&&(n+=`&taxon_id=${l}`),v==="species"?n+=`&taxon_name=${encodeURIComponent(t)}`:n+=`&q=${encodeURIComponent(t)}`;const m=await(await fetch(n)).json();if(m.results.length===0){e.innerHTML="No results found.";return}const c=document.createElement("div");c.className="observation-grid",m.results.forEach(a=>{const i=a.species_guess||a.taxon?.preferred_common_name||a.taxon?.name||"Unknown Species",s=document.createElement("div");s.className="observation-item";const u=a.photos[0]?.url||"";s.innerHTML=`
            <img src="${u}" alt="${i}" loading="lazy" class="thumbnail">
            <div class="observation-info">
              <h3>${i}</h3>
              <p>Observed on: ${new Date(a.observed_on).toLocaleDateString()}</p>
            </div>
          `,c.appendChild(s),s.querySelector(".thumbnail").addEventListener("click",()=>{o.style.display="block",g.src=f(u),h.innerHTML=`${i}<br>Observed on: ${new Date(a.observed_on).toLocaleDateString()}`})}),e.innerHTML="",e.appendChild(c)}catch(n){console.error("Error fetching iNaturalist data:",n),e.innerHTML="Error loading iNaturalist data."}}p.addEventListener("click",()=>{d(r.value)}),r.addEventListener("keypress",t=>{t.key==="Enter"&&d(r.value)}),y.onclick=function(){o.style.display="none"},window.onclick=function(t){t.target==o&&(o.style.display="none")}}else console.error("Could not find necessary elements for iNaturalist data");
