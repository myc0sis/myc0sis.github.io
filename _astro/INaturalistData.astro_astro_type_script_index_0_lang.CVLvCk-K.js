document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("inaturalist-data"),s=document.getElementById("search-input"),m=document.getElementById("search-button"),n=document.getElementById("image-modal"),i=document.getElementById("modal-image"),c=document.getElementById("modal-caption"),u=document.getElementsByClassName("close")[0];if(e&&s&&m&&n&&i&&c&&u){let y=function(t){return t.replace("square","large")};const E=e.dataset.perPage||"5",p=e.dataset.taxonId,L=e.dataset.searchType||"general";async function g(t){if(!t.trim()){e&&(e.innerHTML="Please enter a search term.");return}e&&(e.innerHTML="Loading...");try{let a=`https://api.inaturalist.org/v1/observations?per_page=${E}&order=desc&order_by=created_at`;p&&(a+=`&taxon_id=${p}`),L==="species"?a+=`&taxon_name=${encodeURIComponent(t)}`:a+=`&q=${encodeURIComponent(t)}`;const f=await(await fetch(a)).json();if(f.results.length===0){e&&(e.innerHTML="No results found.");return}const l=document.createElement("div");l.className="observation-grid",f.results.forEach(o=>{const d=o.species_guess||o.taxon?.preferred_common_name||o.taxon?.name||"Unknown Species",r=document.createElement("div");r.className="observation-item";const h=o.photos[0]?.url||"";r.innerHTML=`
              <img src="${h}" alt="${d}" loading="lazy" class="thumbnail">
              <div class="observation-info">
                <h3>${d}</h3>
                <p>Observed on: ${new Date(o.observed_on).toLocaleDateString()}</p>
              </div>
            `,l.appendChild(r),r.querySelector(".thumbnail").addEventListener("click",()=>{n&&i&&c&&(n.style.display="block",i.src=y(h),c.innerHTML=`${d}<br>Observed on: ${new Date(o.observed_on).toLocaleDateString()}`)})}),e&&(e.innerHTML="",e.appendChild(l))}catch(a){console.error("Error fetching iNaturalist data:",a),e&&(e.innerHTML="Error loading iNaturalist data. Please try again.")}}m.addEventListener("click",()=>{g(s.value)}),s.addEventListener("keypress",t=>{t.key==="Enter"&&g(s.value)}),u.onclick=function(){n.style.display="none"},window.onclick=function(t){t.target==n&&(n.style.display="none")}}else console.error("Could not find necessary elements for iNaturalist data")});
