const t=document.getElementById("inaturalist-data"),r=document.getElementById("search-input"),p=document.getElementById("search-button"),o=document.getElementById("image-modal"),g=document.getElementById("modal-image"),h=document.getElementById("modal-caption"),y=document.getElementsByClassName("close")[0];if(t&&r&&p&&o&&g&&h&&y){let f=function(e){return e.replace("square","large")};const E=t.dataset.perPage||"5",d=t.dataset.taxonId,v=t.dataset.searchType||"general";async function c(e=""){try{let n=`https://api.inaturalist.org/v1/observations?per_page=${E}&order=desc&order_by=created_at`;d&&(n+=`&taxon_id=${d}`),e&&(v==="species"?n+=`&taxon_name=${encodeURIComponent(e)}`:n+=`&q=${encodeURIComponent(e)}`);const m=await(await fetch(n)).json();if(t.innerHTML="",m.results.length===0){t.innerHTML="No results found.";return}const i=document.createElement("div");i.className="observation-grid",m.results.forEach(a=>{const l=a.species_guess||a.taxon?.preferred_common_name||a.taxon?.name||"Unknown Species",s=document.createElement("div");s.className="observation-item";const u=a.photos[0]?.url||"";s.innerHTML=`
            <img src="${u}" alt="${l}" loading="lazy" class="thumbnail">
            <div class="observation-info">
              <h3>${l}</h3>
              <p>Observed on: ${new Date(a.observed_on).toLocaleDateString()}</p>
            </div>
          `,i.appendChild(s),s.querySelector(".thumbnail").addEventListener("click",()=>{o.style.display="block",g.src=f(u),h.innerHTML=`${l}<br>Observed on: ${new Date(a.observed_on).toLocaleDateString()}`})}),t.appendChild(i)}catch(n){console.error("Error fetching iNaturalist data:",n),t.innerHTML="Error loading iNaturalist data."}}p.addEventListener("click",()=>{c(r.value)}),r.addEventListener("keypress",e=>{e.key==="Enter"&&c(r.value)}),y.onclick=function(){o.style.display="none"},window.onclick=function(e){e.target==o&&(o.style.display="none")},c()}else console.error("Could not find necessary elements for iNaturalist data");
